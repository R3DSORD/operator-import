#!/usr/local/bin/ansible-playbook --inventory=inventory

- name: ' Operators '
  hosts: local
  vars_files:
    - vars/global.yml

  tasks:
    - name: Create auth directory
      file:
        path: {{ item }}
        state: directory
      with_items:
        - /root/.docker
        - /root/.kube

    - name: Create auth file
      template:
        src: templates/auth.json
        dest: /root/.docker/auth.json

    - name: Create auth file
      template:
        src: files/kubeconfig
        dest: /root/.kube/config

    - name: Create mapping.txt
      template:
        src: templates/custom-mapping.j2
        dest: manifests/custom-mapping.txt

    - name: Mirror custom catalog images
      shell: oc adm catalog mirror \
        --force \
        --filter-by-os=.* \
        --keep-manifest-list=true \
        --registry-config {{ quay_auth }} \
        -f manifests/custom-custom-mapping.txt \
        --insecure